<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>操作系统（七）：死锁 | Forec&#39;s Notes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="OS" />
    
    <meta name="description" content="整理《Operating System Concepts》 第七版死锁部分，内容均为原书和中文版翻译的摘录，其中原书摘录部分由我 按个人理解简化、翻译为中文，可能存在一些不准确之处 。">
<meta property="og:type" content="article">
<meta property="og:title" content="操作系统（七）：死锁">
<meta property="og:url" content="http://forec.github.io/2016/11/24/os-concepts-7/index.html">
<meta property="og:site_name" content="Forec's Notes">
<meta property="og:description" content="整理《Operating System Concepts》 第七版死锁部分，内容均为原书和中文版翻译的摘录，其中原书摘录部分由我 按个人理解简化、翻译为中文，可能存在一些不准确之处 。">
<meta property="og:image" content="http://7xktmz.com1.z0.glb.clouddn.com/os-concepts-7.jpg">
<meta property="og:updated_time" content="2017-01-05T15:47:07.998Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="操作系统（七）：死锁">
<meta name="twitter:description" content="整理《Operating System Concepts》 第七版死锁部分，内容均为原书和中文版翻译的摘录，其中原书摘录部分由我 按个人理解简化、翻译为中文，可能存在一些不准确之处 。">
    

    
        <link rel="alternate" href="/atom.xml" title="Forec&#39;s Notes" type="application/atom+xml" />
    

    
        <link rel="icon" href="http://7xktmz.com1.z0.glb.clouddn.com/sitefavicon.png# path to favicon" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css" type="text/css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css" type="text/css">

    <link rel="stylesheet" href="/css/style.css" type="text/css">

    <script src="/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css" type="text/css">
    
    
    

</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">主页</a>
                                </li>
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">关于我</a>
                                </li>
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/columns/index.html">专栏</a>
                                </li>
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/projects/index.html">个人项目列表</a>
                                </li>
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="http://forec.cn">FOREC 的官方网站</a>
                                </li>
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/apis/index.html">API</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js" type="text/javascript"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/计算机理论基础/">计算机理论基础</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-os-concepts-7" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        操作系统（七）：死锁
        </h1>
    

            </header>
        
        
            <div class="article-subtitle">
                <a href="/2016/11/24/os-concepts-7/" class="article-date">
    <time datetime="2016-11-24T14:16:22.000Z" itemprop="datePublished">2016-11-24</time>
</a>
                
    <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/">OS</a></li></ul>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <blockquote>
<p>整理《Operating System Concepts》 第七版死锁部分，内容均为原书和中文版翻译的摘录，其中原书摘录部分由我 <strong>按个人理解简化、翻译为中文，可能存在一些不准确之处</strong> 。</p>
</blockquote>
<a id="more"></a>
<h1 id="死锁模型"><a href="#死锁模型" class="headerlink" title="死锁模型"></a>死锁模型</h1><ul>
<li>多道程序环境下，多个进程竞争有限资源。如果某个进程需求的资源被其他进程占用，则该进程可能被永久阻塞，这种情况称为 <strong>死锁（deadlock）</strong> 。</li>
<li>进程按照如下顺序使用资源：<ul>
<li><strong>申请（Request）</strong> ：如果申请不能被允许（如资源正在被其他进程占用），则申请进程必须等待直到获得资源</li>
<li><strong>使用（Use）</strong></li>
<li><strong>释放（Release）</strong></li>
</ul>
</li>
<li>资源的申请和释放都是系统调用，如设备的 <code>request()/release()</code>，文件的 <code>open()/close()</code>，内存的 <code>allocate()/free()</code> 等。对于进程或线程的每次执行，操作系统会检查并确保它们以获得所需资源。系统维护一张记录表，说明某个资源是否空闲，被分配给哪个进程。</li>
<li>永久性资源可分为：<ul>
<li>可剥夺资源（可重用资源）：当进程所占有的并使用的资源被剥夺时，对进程不产生破坏性影响（如内存、CPU）</li>
<li>不可剥夺资源：如打印机等，一旦剥夺则任务执行失败</li>
</ul>
</li>
</ul>
<h1 id="死锁特征"><a href="#死锁特征" class="headerlink" title="死锁特征"></a>死锁特征</h1><ul>
<li>以下四个条件（四个条件并不完全独立）同时成立时，死锁产生：<ul>
<li><strong>互斥（mutual exclusion）</strong> ：至少有一个资源处于互斥模式，即该资源同时只能由一个进程使用。</li>
<li><strong>占有并等待（hold and wait）</strong> ：进程必须占有至少一个资源，并且等待另一资源，且等待的资源已被其他进程占有。</li>
<li><strong>非抢占（no preemptive）</strong> ：资源不能被抢占。</li>
<li><strong>循环等待（circular wait）</strong> ：一组等待进程 <code>{P0, p1, ..., pn}</code>，其中 Pi 等待的资源被 Pi+1 占有，Pn 等待的资源被 P0 占有。</li>
</ul>
</li>
<li>死锁问题可用 <strong>系统资源分配图（system resource-allocation  graph）</strong> 描述：<ul>
<li>该图的节点集合 V 分为系统活动进程集合 <code>P = {P1, P2, ..., Pn}</code> 和系统资源类型集合 <code>R = {R1, R2, ..., Rm}</code>。</li>
<li>从进程 Pi 到资源类型 Rj 的有向边记为 <code>Pi → Rj</code>，称为 <strong>申请边（request edge）</strong> ，表示进程 Pi 已经申请并正在等待资源类型 Rj 的一个实例。</li>
<li>从资源类型 Rj 到进程 Pi 的有向边记为 <code>Rj → Pi</code>，称为 <strong>分配边（assignment edge）</strong> ，表示资源类型 Rj 的一个实例已经分配给进程 Pi。</li>
<li>在图上用圆形表示进程 Pi，用矩形表示资源类型 Rj，资源类型的多个实例在矩形中用圆点表示。</li>
<li>申请边只需指向矩形 Rj，分配边的源点需要指定矩形内部的某个圆点。</li>
<li>当进程 Pi 申请资源类型 Rj 的一个实例时，在资源分配图中加入一条申请边，当该申请可以满足时将该申请边 <strong>立即</strong> 转换为分配边。当进程释放资源时，该分配边从图中删除。</li>
</ul>
</li>
<li>可证明：<ul>
<li><strong>如果分配图中不存在环，则系统未发生进程死锁</strong></li>
<li><strong>如果分配图中存在环且每个资源类型仅有一个实例，则系统已处于进程死锁</strong></li>
<li>如果分配图中存在环，且存在某个资源类型有多个实例，则系统可能处于进程死锁</li>
</ul>
</li>
<li>一个带有死锁的资源分配图如下图所示：<br><img src="http://7xktmz.com1.z0.glb.clouddn.com/resource-allocation-graph-with-deadlock.jpg" width="200px"></li>
</ul>
<h1 id="死锁处理"><a href="#死锁处理" class="headerlink" title="死锁处理"></a>死锁处理</h1><ul>
<li>三种方法可以处理死锁：<ul>
<li>使用某种协议预防或避免死锁，确保系统不进入死锁状态</li>
<li>允许系统进入死锁状态，且系统可以检测到死锁并恢复</li>
<li>忽视死锁问题，认为系统中不可能发生死锁</li>
</ul>
</li>
<li>多数操作系统采用第三种（包括 UNIX 和 Windows），因此死锁由应用程序员处理。</li>
</ul>
<h2 id="死锁预防"><a href="#死锁预防" class="headerlink" title="死锁预防"></a>死锁预防</h2><ul>
<li>根据死锁特征，只要破坏四个条件中的一个使之不同时成立即可实现 <strong>死锁预防（prevention）</strong> 。</li>
<li>破坏互斥：非共享资源必须满足互斥条件，因此此条件无法破坏</li>
<li>破坏占有并等待：必须保证一个进程不能在已经占有其他资源的情况下再申请一个资源，两种方法可选（两种方法 <strong><em>资源利用率均较低</em></strong> ，且 <strong><em>可能导致饥饿</em></strong> ，需要多个常用资源的进程可能会永久等待）：<ul>
<li>每个进程在执行前申请并获得执行期间所需的全部资源；</li>
<li>仅允许进程在没有资源时才可申请资源，在它申请更多资源前必须释放全部已持有资源。</li>
</ul>
</li>
<li>破坏非抢占：如果一个进程在占有一些资源的同时申请了另一个不能立刻被分配的资源（等待列表中的其他进程也没有持有该资源），则该进程目前已获得的所有资源都可被其它正在等待的进程抢占。也就是说，该进程持有的资源被隐式释放了。该进程要想重新执行，必须分配到要申请的资源，同时还要恢复自己在等待时被抢占的资源。此协议通常用于状态可以保存和恢复的资源，如 CPU 寄存器和内存，对于不可剥夺资源无效。</li>
<li>破坏循环等待：系统定义一个函数 <code>F: R → N</code> 为资源类型集合编号，不同资源类型的编号不同。每个 <strong>进程只能按照递增顺序申请资源</strong> ，进程开始执行时可以申请任意数量的资源类型 Ri 的实例，之后若想申请资源类型 Rj 的实例，则必须满足 <code>F(Rj) &gt; F(Ri)</code> 才可申请，否则它必须释放所有编号 <strong>大于</strong> F(Rj) 的资源后才能再申请。<ul>
<li>证明：若存在循环等待，设循环等待的进程集合为 <code>{P0, P1, ..., Pn}</code> ，其中 Pi 等待资源 Ri，且 Ri 被进程 Pi+1 占有，因为 Pi+1 占有资源 Ri 且申请资源 Ri+1，所以对所有 i 有 <code>F(Ri) &lt; F(Ri+1)</code>，即 <code>F(R0) &lt; F(R1) &lt; ... &lt; F(Rn) &lt; F(R0)</code>，假设不成立。</li>
<li>按照此协议，程序员必须按系统为资源定义的顺序来编写程序才可防止死锁。有些软件（如 Witness）可以验证资源锁是否按顺序获取，并对不按顺序获取的代码做出警告。</li>
</ul>
</li>
<li>以上通过限制资源申请来预防死锁的方法可行，但会降低设备使用率和系统吞吐率。</li>
</ul>
<h2 id="死锁避免"><a href="#死锁避免" class="headerlink" title="死锁避免"></a>死锁避免</h2><ul>
<li><strong>死锁避免（deadlock-avoidance）</strong> 算法动态监测资源分配状态以保证循环等待条件无法成立，同时它要求进程提供一定的 <strong>先验信息</strong> ，例如进程执行期间可能需要使用的每种资源类型实例的最大数量。</li>
<li>若系统中的进程按照某个特定顺序执行不会产生死锁，则此时系统处于安全状态，这个进程执行的顺序称为 <strong>安全序列（safe sequence）</strong> 。</li>
<li>安全状态必然不会导致死锁，不安全状态可能会导致死锁状态，死锁状态必然是不安全状态。</li>
<li><strong>资源分配图算法</strong> ：<ul>
<li>适用于每个资源只有一个实例的系统；</li>
<li>向系统资源分配图中加入一种新类型的边，称为 <strong>需求边（claim edge）</strong> 。需求边 <code>Pi-&gt;Rj</code> 表示进程 Pi 可能在将来某时刻申请资源 Rj，需求边用虚线表示。当 Pi 申请资源 Rj 时，需求边 <code>Pi-&gt;Rj</code>变为申请边，当进程 Pi 释放资源 Rj 时，分配边 <code>Rj-&gt;Pi</code> 变成需求边；</li>
<li>若进程 Pi 试图申请资源 Rj，则系统需要检查：如果需求边 <code>Pi-&gt;Rj</code> 变成分配边 <code>Rj-&gt;Pi</code> 后，资源分配图中不存在环（虚实线无所谓），则允许申请，否则进程 Pi 必须等待。</li>
<li>系统检查是否存在环可使用 Tarjan 等求联通子图的 n² 级算法。</li>
<li>一个资源分配图算法的实例如下图。<br><img src="http://7xktmz.com1.z0.glb.clouddn.com/resource-allocation-graph-algorithm.jpg" width="400px"></li>
</ul>
</li>
<li><strong>银行家（Banker’s）算法</strong> ：<ul>
<li>适用于每种资源类型有多个实例的情形，效率低于资源分配图</li>
<li>银行家算法需要在进程请求资源时检查分配后的状态是否保持安全。使用下面的安全性算法可确定系统是否处于安全状态，算法的时间复杂度为 mn²。</li>
</ul>
</li>
<li>银行家算法使用的数据结构：<ul>
<li>Available：长度为 m 的向量，表示每种资源当前可用的（未被分配给进程的）实例数量</li>
<li>Max：n × m 的矩阵，<code>Max[i][j]</code> 表示进程 Pi 在整个生命周期中需要申请资源类型 Rj 实例的最大数量</li>
<li>Allocation：n × m 矩阵，<code>Allocation[i][j]</code> 表示进程 Pi 当前已经持有（已被分配）的资源类型 Rj 的实例数量；Allocation 的第 i 行记作 <code>Allocation[i,]</code>，表示进程 Pi 当前持有的不同资源类型的数量。</li>
<li>Need：n × m 矩阵，<code>Need[i][j] = Max[i][j] - Allocation[i][j]</code>，表示进程 Pi 还可能申请多少个 Rj 类型的资源实例；Need 的第 i 行记作 <code>Need[i,]</code>，表示进程 Pi 结束前可能仍要申请的不同资源数量</li>
</ul>
</li>
<li><strong>安全性算法</strong> ：<ol>
<li>令 <code>Work = Available</code> 为长度为 m 的行向量，表示每种资源当前剩余可用的实例数量；令 <code>Finish=[False for i = 0 to n-1]</code> 为长度为 n 的行向量，初始化全部为 False，表示进程当前是否已结束执行。</li>
<li>寻找一个正在执行的进程 Pi，并且 <code>Need[i,] ≤ Work</code>，即：<code>Finish[i] == False &amp;&amp; Need[i,] ≤ Work</code>，这意味着当前系统剩余资源能够满足 Pi 的全部需求。若不存在这样的进程，则调到第 4 步。</li>
<li>更新 <code>Work = Work + Allocation[i,]</code> ，令 <code>Finish[i] = True</code> 并跳回第 2 步。这意味着进程 Pi 已经执行结束，并且它所持有的资源全部释放，因此系统可用资源数量 <code>Work</code> 增加。注意这一步实际 <strong>等价于对资源分配图的化简</strong> ，它将一个可消去的进程（即该进程可以得到资源并执行完）和所有该进程与相关资源连接的边从资源分配图中删去。</li>
<li>检查所有的 i，是否都有 <code>Finish[i] == True</code>，若是则系统处于安全状态，否则系统处于不安全状态。</li>
</ol>
</li>
<li>安全性算法的 C 语言大致表述：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> NUM_PROCESS <span class="number">20</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> NUM_RESOURCE <span class="number">10</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> TRUE <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> FALSE <span class="number">0</span></span></span><br><span class="line"><span class="keyword">typedef</span> Boolean <span class="keyword">unsigned</span> <span class="keyword">int</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> Available[NUM_PROCESS];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> Max[NUM_PROCESS][NUM_RESOURCE];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> Allocation[NUM_PROCESS][NUM_RESOURCE];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> Need[NUM_PROCESS][NUM_RESOURCE];</span><br><span class="line"><span class="function">Boolean <span class="title">safe</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Boolean Finish[NUM_PROCESS];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> Work[NUM_PROCESS];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> i, j, k;</span><br><span class="line">    <span class="built_in">memset</span>(Finish, FALSE, <span class="keyword">sizeof</span>(Boolean) * NUM_PROCESS);</span><br><span class="line">    <span class="built_in">memcpy</span>(Work, Available, <span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">int</span>) * NUM_PROCESS);</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; NUM_PROCESS; k++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; NUM_PROCESS; i++)&#123;</span><br><span class="line">            <span class="comment">// 寻找满足条件的 Pi</span></span><br><span class="line">            <span class="keyword">if</span> (Finish[i])</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            Boolean flag = TRUE;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; NUM_RESOURCE; j++)</span><br><span class="line">                <span class="keyword">if</span> (Need[i][j] &gt; Work[j])&#123;</span><br><span class="line">                    flag = FALSE;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">if</span> (flag)&#123;    <span class="comment">// 寻找到进程 Pi 满足条件</span></span><br><span class="line">                <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; NUM_RESOURCE; j++)</span><br><span class="line">                    Work[j] += Allocation[i][j];</span><br><span class="line">                Finish[i] = TRUE;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// 进程 Pi 结束执行</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; NUM_PROCESS; k++)</span><br><span class="line">        <span class="keyword">if</span> (!Finish[k])</span><br><span class="line">            <span class="keyword">return</span> FALSE;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>资源请求算法</strong> ：判断进程对资源的申请是否可以维持安全性。设申请资源的进程为 Pi，<code>Request[i,]</code> 为一个长度为 m 的行向量，表示进程 Pi 要申请的不同资源实例数量。<ol>
<li>若 <code>Request[i,] ≤ Need[i,]</code> 则转到第 2 步，否则产生出错条件（进程 Pi 要申请的资源数量超过了它此前声明的可能使用的最大资源数量）</li>
<li>若 <code>Request[i,] ≤ Available</code> 则转第 3 步，否则 Pi 等待（剩余资源不满足 Pi 的请求）</li>
<li>假设系统剩余资源足够 Pi 使用，则系统计算修改后的状态是否安全，若安全则允许修改，不安全则 Pi 必须等待。</li>
</ol>
</li>
<li>资源请求算法的 C 语言大致表述为：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Boolean <span class="title">allocate</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> i, <span class="keyword">unsigned</span> <span class="keyword">int</span> *Request)</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> j;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; NUM_RESOURCE; j++)</span><br><span class="line">        <span class="keyword">if</span> (Request[j] &gt; Need[i][j])</span><br><span class="line">            <span class="keyword">return</span> False;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; NUM_RESOURCE; j++)</span><br><span class="line">        <span class="keyword">if</span> (Request[j] &gt; Allocation[i][j])</span><br><span class="line">            wait();    <span class="comment">// 进程 Pi 必须等待资源</span></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; NUM_RESOURCE; j++)&#123;</span><br><span class="line">        Available[j] -= Request[j];</span><br><span class="line">        Allocation[i][j] += Request[j];</span><br><span class="line">        Need[i][j] -= Request[j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 假设可以分配</span></span><br><span class="line">    <span class="keyword">if</span> (!safe())&#123;    <span class="comment">// 分配后不安全，恢复状态</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; NUM_RESOURCE; j++)&#123;</span><br><span class="line">            Available[j] += Request[j];</span><br><span class="line">            Allocation[i][j] -= Request[j];</span><br><span class="line">            Need[i][j] += Request[j];</span><br><span class="line">        &#125;</span><br><span class="line">        wait();</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="死锁检测"><a href="#死锁检测" class="headerlink" title="死锁检测"></a>死锁检测</h2><ul>
<li>如果一个系统既不采用死锁预防算法，也不采用死锁避免算法，则该系统可能出现死锁。此时，系统应当提供：<ul>
<li>检查系统是否出现死锁的算法</li>
<li>从死锁状态中恢复的算法</li>
</ul>
</li>
<li>每个资源类型仅存在一个实例：可以使用资源分配图的变种 <strong>等待（wait-for）图</strong> ，该图删去了资源分配图中的资源节点，而将原图中所有 <code>Pi-&gt;Rj-&gt;Pk</code>　的边转化为 <code>Pi-&gt;Pk</code>，即进程 Pi 正在等待进程 Pk 掌握的资源。如果等待图中有环存在，则系统存在死锁。为了检测死锁，系统要维护这个等待图，并且周期性的在图中调用检测算法，该算法时间复杂度为 n²，n 为系统中进程数。</li>
<li>每种资源类型存在多个实例：算法与银行家算法类似，仍采用 <code>Available</code>，<code>Allocation</code> 和 <code>Request</code> 三个变量保存系统状态，其中此处的 <code>Request</code> 是一个 n × m 的矩阵，<code>Request[i][j]</code> 表示进程 Pi 当前正在申请的资源类型 Rj 的数量。</li>
<li><strong>死锁检测算法</strong> ，时间复杂度为 mn²：<ol>
<li>令 <code>Work = Available</code> 为长度为 m 的行向量，表示每种资源当前剩余可用的实例数量；令 <code>Finish</code> 为长度为 n 的行向量，若进程 Pi 当前未持有任何资源（Allocation[i,] == 0）则 <code>Finish[i] = True</code>，否则 <code>Finish[i] = False</code>。这里将不持有资源的进程设置 Finish 为 True 是因为，不持有资源的进程不会对死锁产生影响，不会有其它进程在等待该进程，这实际 <strong>等价于等待图中的孤立点</strong> 。</li>
<li>寻找一个正在执行的进程 Pi，并且 <code>Request[i,] ≤ Work</code>，即：<code>Finish[i] == False &amp;&amp; Request[i,] ≤ Work</code>，这意味着当前系统剩余资源能够满足 Pi 此刻的需求。若不存在这样的进程，则调到第 4 步。</li>
<li>更新 <code>Work = Work + Allocation[i,]</code> 且令 <code>Finish[i] = True</code>；跳回第 2 步。</li>
<li>检查是否存在某个 i 有 <code>Finish[i] == False</code>，若存在则系统处于死锁状态，且进程 Pi 死锁。</li>
</ol>
</li>
<li>注意上面的死锁检测算法的第 2 步：如果 <code>Request[i,] ≤ Work</code> 就回收进程 Pi 的资源。这是基于如下假定，如果 Pi 不会参与到死锁中（因为 <code>Request[i,] ≤ Work</code>，Pi的需求可以被满足所以此时一定不会被死锁），则 <strong>乐观地认为 Pi 直到执行结束都不会再申请更多的资源</strong> 。这里的假定可能不正确，如果假定不正确，Pi 在之后又申请了更多的资源，则在系统下次运行死锁检测算法时仍然会发现，所以这里的假定不影响算法正确性。</li>
<li><strong>调用检测算法的频率</strong> 受如下两个因素影响：<ul>
<li>死锁可能发生的概率多少：如果经常发生死锁则应该经常调用检测算法</li>
<li>死锁发生时有多少进程会受影响</li>
</ul>
</li>
<li>考虑极端情况：每当出现进程请求资源不能被立刻允许的情况时就调用死锁检测算法，则系统不仅能确定哪些进程处于死锁，还能确定导致死锁的特定进程（实际上是死锁环上的每个节点共同导致了死锁）。此种方式会导致巨大的计算开销。但如果使用较低的频率调用检测算法，或当 CPU 使用率低于某个阈值时，则调用检测算法无法确定涉及死锁的进程中是哪些导致了死锁。</li>
</ul>
<h2 id="死锁恢复"><a href="#死锁恢复" class="headerlink" title="死锁恢复"></a>死锁恢复</h2><h3 id="进程终止"><a href="#进程终止" class="headerlink" title="进程终止"></a>进程终止</h3><ul>
<li>两种方法通过终止进程来取消死锁，被终止的进程所持有的所有资源都会被系统回收：<ul>
<li><strong>终止所有死锁进程</strong> ：代价较大，有些进程可能已经运行很长时间而不得不放弃</li>
<li><strong>每次终止一个进程，直到死锁状态取消</strong> ：开销较大，每终止一个进程都需要重新调用死锁检测算法</li>
</ul>
</li>
<li>当采用部分终止时，确定终止哪个进程/哪个进程可以打破死锁的因素涉及：<ul>
<li>进程优先级</li>
<li>进程已运行的时间和完成任务所需要的剩余时间</li>
<li>进程使用了哪些、多少资源，以及资源是否可抢占</li>
<li>进程仍需多少资源</li>
<li>有多少进程需要被终止</li>
<li>交互进程还是批处理进程</li>
</ul>
</li>
</ul>
<h3 id="资源抢占"><a href="#资源抢占" class="headerlink" title="资源抢占"></a>资源抢占</h3><ul>
<li>死锁的恢复也可以通过抢占资源来逐步取消死锁状态，需要处理三个问题：<ul>
<li><strong>选择被抢占对象（victim）</strong> ：抢占哪些进程和资源，这和死锁恢复中部分终止要考虑的因素类似。</li>
<li><strong>回滚（rollback）</strong> ：如果从某个进程抢占资源，则被抢占的进程需要回滚到某个安全状态以便之后重新执行。完全回滚（终止被抢占的进程并重启该进程）比较容易，更有效的方式是将进程回滚到足够打破死锁的状态，但这需要系统维护更多关于进程状态的信息。</li>
<li><strong>饥饿</strong> ：如何确保不会总从同一个进程抢占资源。通常会考虑回滚次数，确保一个进程只能被抢占有限次。</li>
</ul>
</li>
</ul>
<hr>
<p>专栏目录：<a href="http://blog.forec.cn/columns/cs-basic.html" target="_blank" rel="external">计算机理论基础</a><br>此专栏的上一篇文章：<a href="http://blog.forec.cn/2016/11/24/os-concepts-6/" target="_blank" rel="external">操作系统（六）：管程（Monitor）</a><br>此专栏的下一篇文章：<a href="http://blog.forec.cn/2017/01/03/os-concepts-8/" target="_blank" rel="external">操作系统（八）：内存管理</a>    </p>
<p>参考资料：《操作系统概念 英文第七版》，恐龙书，英文名《Operating System Concepts》，作者 Abraham Silberschatz、Peter Baer Galvin、Greg Gagne</p>
<p>原创作品，允许转载，转载时无需告知，但请务必以超链接形式标明文章<a href="http://blog.forec.cn/2016/11/24/os-concepts-7/" target="_blank" rel="external">原始出处</a>(<a href="http://blog.forec.cn/2016/11/24/os-concepts-7/" target="_blank" rel="external">http://blog.forec.cn/2016/11/24/os-concepts-7/</a>) 、作者信息（<a href="http://forec.cn/" target="_blank" rel="external">Forec</a>）和本声明。</p>

        </div>
        <footer class="article-footer">
            



    <a data-url="http://forec.github.io/2016/11/24/os-concepts-7/" data-id="ciyu1xvn90039vkew8zgrtyia" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div class="ds-thread" data-thread-key="2016/11/24/os-concepts-7/" data-title="操作系统（七）：死锁" data-url="http://forec.github.io/2016/11/24/os-concepts-7/"></div>
    <style>
        #ds-thread #ds-reset .ds-textarea-wrapper {
            background: none;
        }
        #ds-reset .ds-avatar img {
            box-shadow: none;
        }
        #ds-reset .ds-gradient-bg {
            background: #f7f7f7;
        }
        #ds-thread #ds-reset li.ds-tab a {
            border-radius: 3px;
        }
        #ds-thread #ds-reset .ds-post-button {
            color: white;
            border: none;
            box-shadow: none;
            background: #d32;
            text-shadow: none;
            font-weight: normal;
            font-family: 'Microsoft Yahei';
        }
        #ds-thread #ds-reset .ds-post-button:hover {
            color: white;
            background: #DE594C;
        }
        #ds-thread #ds-reset .ds-post-button:active {
            background: #d32;
        }
        #ds-smilies-tooltip ul.ds-smilies-tabs li a.ds-current {
            color: white;
            background: #d32;
            box-shadow: none;
            text-shadow: none;
            font-weight: normal;
        }
    </style>

    
    </section>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/Forec" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="google-plus-circle" href="https://plus.google.com/u/0/103559279723380829001" target="_blank">
                        <i class="icon fa fa-google-plus-circle"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="https://www.facebook.com/MrForec" target="_blank">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="https://twitter.com/MrForec" target="_blank">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/atom.xml" target="_blank">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="mail-forward" href="mailto:forec@bupt.edu.cn" target="_blank">
                        <i class="icon fa fa-mail-forward"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2016/11/30/efficient-haskell-io/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            Haskell 中的高效 I/O
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2016/11/24/os-concepts-6/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">操作系统（六）：管程（Monitor）</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/02/06/talk-about-hmm/" class="thumbnail">
    
    
        <span style="background-image:url(http://7xktmz.com1.z0.glb.clouddn.com/talk-about-hmm.jpg)" alt="HMM 关键词检索" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/计算机理论基础/">计算机理论基础</a></p>
                            <p class="item-title"><a href="/2017/02/06/talk-about-hmm/" class="title">HMM 关键词检索</a></p>
                            <p class="item-date"><time datetime="2017-02-06T08:22:30.000Z" itemprop="datePublished">2017-02-06</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/01/31/vscode-configuration/" class="thumbnail">
    
    
        <span style="background-image:url(http://7xktmz.com1.z0.glb.clouddn.com/vscode-configuration.jpg)" alt="VS Code 配置记录" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Configuration/">Configuration</a></p>
                            <p class="item-title"><a href="/2017/01/31/vscode-configuration/" class="title">VS Code 配置记录</a></p>
                            <p class="item-date"><time datetime="2017-01-31T07:38:13.000Z" itemprop="datePublished">2017-01-31</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/01/08/os-concepts-16/" class="thumbnail">
    
    
        <span style="background-image:url(http://7xktmz.com1.z0.glb.clouddn.com/os-concepts-16.jpg)" alt="互斥读者-读者问题" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/计算机理论基础/">计算机理论基础</a></p>
                            <p class="item-title"><a href="/2017/01/08/os-concepts-16/" class="title">互斥读者-读者问题</a></p>
                            <p class="item-date"><time datetime="2017-01-08T09:52:59.000Z" itemprop="datePublished">2017-01-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/01/08/os-concepts-15/" class="thumbnail">
    
    
        <span style="background-image:url(http://7xktmz.com1.z0.glb.clouddn.com/os-concepts-15.jpg)" alt="操作系统（专题）：信号量编程（下）" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/计算机理论基础/">计算机理论基础</a></p>
                            <p class="item-title"><a href="/2017/01/08/os-concepts-15/" class="title">操作系统（专题）：信号量编程（下）</a></p>
                            <p class="item-date"><time datetime="2017-01-08T03:53:13.000Z" itemprop="datePublished">2017-01-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/01/06/os-concepts-14/" class="thumbnail">
    
    
        <span style="background-image:url(http://7xktmz.com1.z0.glb.clouddn.com/os-concepts-14-r.jpg)" alt="操作系统（专题）：信号量编程（上）" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/计算机理论基础/">计算机理论基础</a></p>
                            <p class="item-title"><a href="/2017/01/06/os-concepts-14/" class="title">操作系统（专题）：信号量编程（上）</a></p>
                            <p class="item-date"><time datetime="2017-01-06T09:21:43.000Z" itemprop="datePublished">2017-01-06</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Code/">Code</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Configuration/">Configuration</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Language/">Language</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机理论基础/">计算机理论基础</a><span class="category-list-count">23</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/Access/" style="font-size: 10px;">Access</a> <a href="/tags/Algorithms/" style="font-size: 20px;">Algorithms</a> <a href="/tags/CVM/" style="font-size: 10px;">CVM</a> <a href="/tags/Data-Structures/" style="font-size: 11.82px;">Data-Structures</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Emacs/" style="font-size: 10px;">Emacs</a> <a href="/tags/Golang/" style="font-size: 16.36px;">Golang</a> <a href="/tags/Hadoop/" style="font-size: 10.91px;">Hadoop</a> <a href="/tags/Haskell/" style="font-size: 13.64px;">Haskell</a> <a href="/tags/Mistakes/" style="font-size: 12.73px;">Mistakes</a> <a href="/tags/OS/" style="font-size: 19.09px;">OS</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Qt/" style="font-size: 10px;">Qt</a> <a href="/tags/Raspberry/" style="font-size: 10px;">Raspberry</a> <a href="/tags/Safety/" style="font-size: 10px;">Safety</a> <a href="/tags/Spark/" style="font-size: 10px;">Spark</a> <a href="/tags/sicp/" style="font-size: 10.91px;">sicp</a> <a href="/tags/云存储/" style="font-size: 15.45px;">云存储</a> <a href="/tags/函数式编程/" style="font-size: 14.55px;">函数式编程</a> <a href="/tags/图分割/" style="font-size: 10.91px;">图分割</a> <a href="/tags/字符编码/" style="font-size: 10.91px;">字符编码</a> <a href="/tags/机器学习/" style="font-size: 18.18px;">机器学习</a> <a href="/tags/线程/" style="font-size: 17.27px;">线程</a> <a href="/tags/计组与体系结构/" style="font-size: 13.64px;">计组与体系结构</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://forec.cn">Forec的官方网站</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>京ICP备16060806号-1 &copy; 2017 Forec</p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'forec'};
    (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>



    
        <script src="/libs/lightgallery/js/lightgallery.min.js" type="text/javascript"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js" type="text/javascript"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js" type="text/javascript"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js" type="text/javascript"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js" type="text/javascript"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js" type="text/javascript"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js" type="text/javascript"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js" type="text/javascript"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js" type="text/javascript"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js" type="text/javascript"></script>

    </div>
</body>
</html>
